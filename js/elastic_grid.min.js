function parseVideoURL(a) {
    function b(a, b) {
        var c = new RegExp("(\\?|&)" + b + "\\=([^&]*)(&|$)"),
            d = a.match(c);
        return d ? d[2] : ""
    }
    var d, c = {},
        e = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    return -1 != a.indexOf("youtube.com/watch") ? (c.provider = "youtube", c.id = b(a, "v"), c.embed = "//www.youtube.com/embed/" + c.id + "?fs=0") : (d = a.match(e)) ? (c.provider = "youtube", c.id = d[2], c.embed = "//www.youtube.com/embed/" + c.id + "?fs=0") : (d = a.match(/vimeo.com\/(\d+)/)) && (c.provider = "vimeo", c.id = d[1], c.embed = "//player.vimeo.com/video/" + c.id + "?fullscreen=0"), c
}! function(a, b, c) {
    "use strict";
    var e, f, d = a.event;
    e = d.special.debouncedresize = {
        setup: function() {
            a(this).on("resize", e.handler)
        },
        teardown: function() {
            a(this).off("resize", e.handler)
        },
        handler: function(a, b) {
            var c = this,
                g = arguments,
                h = function() {
                    a.type = "debouncedresize", d.dispatch.apply(c, g)
                };
            f && clearTimeout(f), b ? h() : f = setTimeout(h, e.threshold)
        },
        threshold: 150
    };
    var g = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
    a.fn.imagesLoaded = function(b) {
        function l() {
            var c = a(j),
                f = a(k);
            e && (k.length ? e.reject(h, c, f) : e.resolve(h)), a.isFunction(b) && b.call(d, h, c, f)
        }

        function m(b, c) {
            b.src !== g && -1 === a.inArray(b, i) && (i.push(b), c ? k.push(b) : j.push(b), a.data(b, "imagesLoaded", {
                isBroken: c,
                src: b.src
            }), f && e.notifyWith(a(b), [c, h, a(j), a(k)]), h.length === i.length && (setTimeout(l), h.unbind(".imagesLoaded")))
        }
        var d = this,
            e = a.isFunction(a.Deferred) ? a.Deferred() : 0,
            f = a.isFunction(e.notify),
            h = d.find("img").add(d.filter("img")),
            i = [],
            j = [],
            k = [];
        return a.isPlainObject(b) && a.each(b, function(a, c) {
            "callback" === a ? b = c : e && e[a](c)
        }), h.length ? h.bind("load.imagesLoaded error.imagesLoaded", function(a) {
            m(a.target, "error" === a.type)
        }).each(function(b, d) {
            var e = d.src,
                f = a.data(d, "imagesLoaded");
            return f && f.src === e ? void m(d, f.isBroken) : d.complete && d.naturalWidth !== c ? void m(d, 0 === d.naturalWidth || 0 === d.naturalHeight) : void((d.readyState || d.complete) && (d.src = g, d.src = e))
        }) : l(), e ? e.promise(d) : d
    };
    var h = a(b),
        i = b.Modernizr;
    a.Elastislide = function(b, c) {
        this.$el = a(c), this._init(b)
    }, a.Elastislide.defaults = {
        orientation: "horizontal",
        speed: 500,
        easing: "ease-in-out",
        minItems: 3,
        start: 0,
        onClick: function(a, b, c) {
            return !1
        },
        onReady: function() {
            return !1
        },
        onBeforeSlide: function() {
            return !1
        },
        onAfterSlide: function() {
            return !1
        }
    }, a.Elastislide.prototype = {
        _init: function(b) {
            this.options = a.extend(!0, {}, a.Elastislide.defaults, b);
            var c = this,
                d = {
                    WebkitTransition: "webkitTransitionEnd",
                    MozTransition: "transitionend",
                    OTransition: "oTransitionEnd",
                    msTransition: "MSTransitionEnd",
                    transition: "transitionend"
                };
            if (this.transEndEventName = d[i.prefixed("transition")], this.support = i.csstransitions && i.csstransforms, this.current = this.options.start, this.isSliding = !1, this.$items = this.$el.children("li"), this.itemsCount = this.$items.length, 0 === this.itemsCount) return !1;
            this._validate(), this.$items.detach(), this.$el.empty(), this.$el.append(this.$items), this.$el.wrap('<div class="elastislide-wrapper elastislide-loading elastislide-' + this.options.orientation + '"></div>'), this.hasTransition = !1, this.hasTransitionTimeout = setTimeout(function() {
                c._addTransition()
            }, 100), this.$el.imagesLoaded(function() {
                c.$el.show(), c._layout(), c._configure(), c.hasTransition ? (c._removeTransition(), c._slideToItem(c.current), c.$el.on(c.transEndEventName, function() {
                    c.$el.off(c.transEndEventName), c._setWrapperSize(), c._addTransition(), c._initEvents()
                })) : (clearTimeout(c.hasTransitionTimeout), c._setWrapperSize(), c._initEvents(), c._slideToItem(c.current), setTimeout(function() {
                    c._addTransition()
                }, 25)), c.options.onReady()
            })
        },
        _validate: function() {
            this.options.speed < 0 && (this.options.speed = 500), (this.options.minItems < 1 || this.options.minItems > this.itemsCount) && (this.options.minItems = 1), (this.options.start < 0 || this.options.start > this.itemsCount - 1) && (this.options.start = 0), "horizontal" != this.options.orientation && "vertical" != this.options.orientation && (this.options.orientation = "horizontal")
        },
        _layout: function() {
            this.$el.wrap('<div class="elastislide-carousel"></div>'), this.$carousel = this.$el.parent(), this.$wrapper = this.$carousel.parent().removeClass("elastislide-loading");
            var a = this.$items.find("img:first");
            this.imgSize = {
                width: a.outerWidth(!0),
                height: a.outerHeight(!0)
            }, this._setItemsSize(), "horizontal" === this.options.orientation ? this.$el.css("max-height", this.imgSize.height) : this.$el.css("height", this.options.minItems * this.imgSize.height), this._addControls()
        },
        _addTransition: function() {
            this.support && this.$el.css("transition", "all " + this.options.speed + "ms " + this.options.easing), this.hasTransition = !0
        },
        _removeTransition: function() {
            this.support && this.$el.css("transition", "all 0s"), this.hasTransition = !1
        },
        _addControls: function() {
            var b = this;
            this.$navigation = a('<nav><span class="elastislide-prev">Previous</span><span class="elastislide-next">Next</span></nav>').appendTo(this.$wrapper), this.$navPrev = this.$navigation.find("span.elastislide-prev").on("mousedown.elastislide", function(a) {
                return b._slide("prev"), !1
            }), this.$navNext = this.$navigation.find("span.elastislide-next").on("mousedown.elastislide", function(a) {
                return b._slide("next"), !1
            })
        },
        _setItemsSize: function() {
            var a = "horizontal" === this.options.orientation ? 100 * Math.floor(this.$carousel.width() / this.options.minItems) / this.$carousel.width() : 100;
            this.$items.css({
                width: a + "%",
                "max-width": this.imgSize.width,
                "max-height": this.imgSize.height
            }), "vertical" === this.options.orientation && this.$wrapper.css("max-width", this.imgSize.width + parseInt(this.$wrapper.css("padding-left")) + parseInt(this.$wrapper.css("padding-right")))
        },
        _setWrapperSize: function() {
            "vertical" === this.options.orientation && this.$wrapper.css({
                height: this.options.minItems * this.imgSize.height + parseInt(this.$wrapper.css("padding-top")) + parseInt(this.$wrapper.css("padding-bottom"))
            })
        },
        _configure: function() {
            this.fitCount = "horizontal" === this.options.orientation ? this.$carousel.width() < this.options.minItems * this.imgSize.width ? this.options.minItems : Math.floor(this.$carousel.width() / this.imgSize.width) : this.$carousel.height() < this.options.minItems * this.imgSize.height ? this.options.minItems : Math.floor(this.$carousel.height() / this.imgSize.height)
        },
        _initEvents: function() {
            var b = this;
            h.on("debouncedresize.elastislide", function() {
                b._setItemsSize(), b._configure(), b._slideToItem(b.current)
            }), this.$el.on(this.transEndEventName, function() {
                b._onEndTransition()
            }), "horizontal" === this.options.orientation ? this.$el.on({
                swipeleft: function() {
                    b._slide("next")
                },
                swiperight: function() {
                    b._slide("prev")
                }
            }) : this.$el.on({
                swipeup: function() {
                    b._slide("next")
                },
                swipedown: function() {
                    b._slide("prev")
                }
            }), this.$el.on("click.elastislide", "li", function(c) {
                var d = a(this);
                b.options.onClick(d, d.index(), c)
            })
        },
        _destroy: function(a) {
            this.$el.off(this.transEndEventName).off("swipeleft swiperight swipeup swipedown .elastislide"), h.off(".elastislide"), this.$el.css({
                "max-height": "none",
                transition: "none"
            }).unwrap(this.$carousel).unwrap(this.$wrapper), this.$items.css({
                width: "auto",
                "max-width": "none",
                "max-height": "none"
            }), this.$navigation.remove(), this.$wrapper.remove(), a && a.call()
        },
        _toggleControls: function(a, b) {
            b ? "next" === a ? this.$navNext.show() : this.$navPrev.show() : "next" === a ? this.$navNext.hide() : this.$navPrev.hide()
        },
        _slide: function(b, d) {
            if (this.isSliding) return !1;
            this.options.onBeforeSlide(), this.isSliding = !0;
            var e = this,
                f = this.translation || 0,
                g = "horizontal" === this.options.orientation ? this.$items.outerWidth(!0) : this.$items.outerHeight(!0),
                h = this.itemsCount * g,
                i = "horizontal" === this.options.orientation ? this.$carousel.width() : this.$carousel.height();
            if (d === c) {
                var j = this.fitCount * g;
                if (j < 0) return !1;
                if ("next" === b && h - (Math.abs(f) + j) < i) j = h - (Math.abs(f) + i), this._toggleControls("next", !1), this._toggleControls("prev", !0);
                else if ("prev" === b && Math.abs(f) - j < 0) j = Math.abs(f), this._toggleControls("next", !0), this._toggleControls("prev", !1);
                else {
                    var k = "next" === b ? Math.abs(f) + Math.abs(j) : Math.abs(f) - Math.abs(j);
                    k > 0 ? this._toggleControls("prev", !0) : this._toggleControls("prev", !1), k < h - i ? this._toggleControls("next", !0) : this._toggleControls("next", !1)
                }
                d = "next" === b ? f - j : f + j
            } else {
                var j = Math.abs(d);
                Math.max(h, i) - j < i && (d = -(Math.max(h, i) - i)), j > 0 ? this._toggleControls("prev", !0) : this._toggleControls("prev", !1), Math.max(h, i) - i > j ? this._toggleControls("next", !0) : this._toggleControls("next", !1)
            }
            if (this.translation = d, f === d) return this._onEndTransition(), !1;
            if (this.support) "horizontal" === this.options.orientation ? this.$el.css("transform", "translateX(" + d + "px)") : this.$el.css("transform", "translateY(" + d + "px)");
            else {
                a.fn.applyStyle = this.hasTransition ? a.fn.animate : a.fn.css;
                var l = "horizontal" === this.options.orientation ? {
                    left: d
                } : {
                    top: d
                };
                this.$el.stop().applyStyle(l, a.extend(!0, [], {
                    duration: this.options.speed,
                    complete: function() {
                        e._onEndTransition()
                    }
                }))
            }
            this.hasTransition || this._onEndTransition()
        },
        _onEndTransition: function() {
            this.isSliding = !1, this.options.onAfterSlide()
        },
        _slideTo: function(a) {
            var a = a || this.current,
                b = Math.abs(this.translation) || 0,
                c = "horizontal" === this.options.orientation ? this.$items.outerWidth(!0) : this.$items.outerHeight(!0),
                d = b + this.$carousel.width(),
                e = Math.abs(a * c);
            (e + c > d || e < b) && this._slideToItem(a)
        },
        _slideToItem: function(a) {
            var b = "horizontal" === this.options.orientation ? a * this.$items.outerWidth(!0) : a * this.$items.outerHeight(!0);
            this._slide("", -b)
        },
        add: function(a) {
            var b = this,
                c = this.current,
                d = this.$items.eq(this.current);
            this.$items = this.$el.children("li"), this.itemsCount = this.$items.length, this.current = d.index(), this._setItemsSize(), this._configure(), this._removeTransition(), c < this.current ? this._slideToItem(this.current) : this._slide("next", this.translation), setTimeout(function() {
                b._addTransition()
            }, 25), a && a.call()
        },
        setCurrent: function(a, b) {
            this.current = a, this._slideTo(), b && b.call()
        },
        next: function() {
            self._slide("next")
        },
        previous: function() {
            self._slide("prev")
        },
        slideStart: function() {
            this._slideTo(0)
        },
        slideEnd: function() {
            this._slideTo(this.itemsCount - 1)
        },
        destroy: function(a) {
            this._destroy(a)
        }
    };
    var j = function(a) {
        b.console && b.console.error(a)
    };
    a.fn.elastislide = function(b) {
        var c = a.data(this, "elastislide");
        if ("string" == typeof b) {
            var d = Array.prototype.slice.call(arguments, 1);
            this.each(function() {
                return c ? a.isFunction(c[b]) && "_" !== b.charAt(0) ? void c[b].apply(c, d) : void j("no such method '" + b + "' for elastislide self") : void j("cannot call methods on elastislide prior to initialization; attempted to call method '" + b + "'")
            })
        } else this.each(function() {
            c ? c._init() : c = a.data(this, "elastislide", new a.Elastislide(b, this))
        });
        return c
    }
}(jQuery, window),
function(a, b, c) {
    "use strict";
    a.HoverDir = function(b, c) {
        this.$el = a(c), this._init(b)
    }, a.HoverDir.defaults = {
        speed: 300,
        easing: "ease",
        hoverDelay: 0,
        inverse: !1
    }, a.HoverDir.prototype = {
        _init: function(b) {
            this.options = a.extend(!0, {}, a.HoverDir.defaults, b), this.transitionProp = "all " + this.options.speed + "ms " + this.options.easing, this.support = Modernizr.csstransitions, this._loadEvents()
        },
        _loadEvents: function() {
            var b = this;
            this.$el.on("mouseenter.hoverdir, mouseleave.hoverdir", function(c) {
                var d = a(this),
                    e = d.find("figure"),
                    f = b._getDir(d, {
                        x: c.pageX,
                        y: c.pageY
                    }),
                    g = b._getStyle(f);
                "mouseenter" === c.type ? (e.hide().css(g.from), clearTimeout(b.tmhover), b.tmhover = setTimeout(function() {
                    e.show(0, function() {
                        var c = a(this);
                        b.support && c.css("transition", b.transitionProp), b._applyAnimation(c, g.to, b.options.speed)
                    })
                }, b.options.hoverDelay)) : (b.support && e.css("transition", b.transitionProp), clearTimeout(b.tmhover), b._applyAnimation(e, g.from, b.options.speed))
            })
        },
        _getDir: function(a, b) {
            var c = a.width(),
                d = a.height(),
                e = (b.x - a.offset().left - c / 2) * (c > d ? d / c : 1),
                f = (b.y - a.offset().top - d / 2) * (d > c ? c / d : 1);
            return Math.round((Math.atan2(f, e) * (180 / Math.PI) + 180) / 90 + 3) % 4
        },
        _getStyle: function(a) {
            var b, c, d = {
                    left: "0px",
                    top: "-100%"
                },
                e = {
                    left: "0px",
                    top: "100%"
                },
                f = {
                    left: "-100%",
                    top: "0px"
                },
                g = {
                    left: "100%",
                    top: "0px"
                },
                h = {
                    top: "0px"
                },
                i = {
                    left: "0px"
                };
            switch (a) {
                case 0:
                    b = this.options.inverse ? e : d, c = h;
                    break;
                case 1:
                    b = this.options.inverse ? f : g, c = i;
                    break;
                case 2:
                    b = this.options.inverse ? d : e, c = h;
                    break;
                case 3:
                    b = this.options.inverse ? g : f, c = i
            }
            return {
                from: b,
                to: c
            }
        },
        _applyAnimation: function(b, c, d) {
            a.fn.applyStyle = this.support ? a.fn.css : a.fn.animate, b.stop().applyStyle(c, a.extend(!0, [], {
                duration: d + "ms"
            }))
        }
    };
    var d = function(a) {
        b.console && b.console.error(a)
    };
    a.fn.hoverdir = function(b) {
        var c = a.data(this, "hoverdir");
        if ("string" == typeof b) {
            var e = Array.prototype.slice.call(arguments, 1);
            this.each(function() {
                return c ? a.isFunction(c[b]) && "_" !== b.charAt(0) ? void c[b].apply(c, e) : void d("no such method '" + b + "' for hoverdir instance") : void d("cannot call methods on hoverdir prior to initialization; attempted to call method '" + b + "'")
            })
        } else this.each(function() {
            c ? c._init() : c = a.data(this, "hoverdir", new a.HoverDir(b, this))
        });
        return c
    }
}(jQuery, window);
var $event = $.event,
    $special, resizeTimeout;
$special = $event.special.debouncedresize = {
    setup: function() {
        $(this).on("resize", $special.handler)
    },
    teardown: function() {
        $(this).off("resize", $special.handler)
    },
    handler: function(a, b) {
        var c = this,
            d = arguments,
            e = function() {
                a.type = "debouncedresize", $event.dispatch.apply(c, d)
            };
        resizeTimeout && clearTimeout(resizeTimeout), b ? e() : resizeTimeout = setTimeout(e, $special.threshold)
    },
    threshold: 250
};
var BLANK = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
$.fn.imagesLoaded = function(a) {
    function i() {
        var d = $(g),
            f = $(h);
        c && (h.length ? c.reject(e, d, f) : c.resolve(e)), $.isFunction(a) && a.call(b, e, d, f)
    }

    function j(a, b) {
        a.src !== BLANK && -1 === $.inArray(a, f) && (f.push(a), b ? h.push(a) : g.push(a), $.data(a, "imagesLoaded", {
            isBroken: b,
            src: a.src
        }), d && c.notifyWith($(a), [b, e, $(g), $(h)]), e.length === f.length && (setTimeout(i), e.unbind(".imagesLoaded")))
    }
    var b = this,
        c = $.isFunction($.Deferred) ? $.Deferred() : 0,
        d = $.isFunction(c.notify),
        e = b.find("img").add(b.filter("img")),
        f = [],
        g = [],
        h = [];
    return $.isPlainObject(a) && $.each(a, function(b, d) {
        "callback" === b ? a = d : c && c[b](d)
    }), e.length ? e.bind("load.imagesLoaded error.imagesLoaded", function(a) {
        j(a.target, "error" === a.type)
    }).each(function(a, b) {
        var c = b.src,
            d = $.data(b, "imagesLoaded");
        return d && d.src === c ? void j(b, d.isBroken) : b.complete && void 0 !== b.naturalWidth ? void j(b, 0 === b.naturalWidth || 0 === b.naturalHeight) : void((b.readyState || b.complete) && (b.src = BLANK, b.src = c))
    }) : i(), c ? c.promise(b) : b
}, $(function() {
    $.elastic_grid = {
        version: "1.0"
    }, $.fn.elastic_grid = function(a) {
        function n(a, b) {
            a.each(function(a, c) {
                classie.has(c, b) ? (classie.toggle(c, "animate"), classie.remove(c, "hidden")) : (classie.add(c, "hidden"), classie.remove(c, "animate"))
            })
        }

        function o(a) {
            var b = a.toLowerCase().replace(" ", "-");
            if ("" != a) {
                var c = $("<li>");
                $("<a>", {
                    html: a,
                    "data-filter": "." + b,
                    href: "#",
                    class: "filter"
                }).appendTo(c);
                c.appendTo(k)
            }
        }

        function D(a) {
            q.each(function() {
                var b = $(this);
                b.data("offsetTop", b.offset().top), a && b.data("height", b.height())
            })
        }

        function E() {
            F(q), v.on("debouncedresize", function() {
                t = 0, s = -1, D(), G(), void 0 !== $.data(this, "preview") && I()
            })
        }

        function F(a) {
            a.on("click", "span.og-close", function() {
                return I(), !1
            }).children("a").on("click", function(a) {
                var b = $(this).parent();
                return b.removeClass("animate"), r === b.index() ? I($(this)) : H(b), !1
            })
        }

        function G() {
            w = {
                width: v.width(),
                height: v.height()
            }
        }

        function H(a) {
            I();
            var b = $.data(this, "preview"),
                c = a.data("offsetTop");
            if (t = 0, void 0 !== b) {
                if (s === c) return b.update(a), !1;
                c > s && (t = b.height), I()
            }
            s = c, b = $.data(this, "preview", new J(a)), b.open()
        }

        function I() {
            q.find(".og-pointer").remove(), r = -1;
            var a = $.data(this, "preview");
            void 0 === a || a.close(), $.removeData(this, "preview")
        }

        function J(a) {
            this.$item = a, this.expandedIdx = this.$item.index(), this.create(), this.update()
        }
        a = $.extend({}, {
            items: null,
            filterEffect: "",
            hoverDirection: !0,
            hoverDelay: 0,
            hoverInverse: !1,
            expandingHeight: 500,
            expandingSpeed: 300,
            callback: function() {}
        }, a);
        var b = $(this),
            c = a.items.length;
        if (0 == c) return !1;
        b.html('<div class="wagwep-container"><nav id="porfolio-nav" class="clearfix"><ul id="portfolio-filter" class="nav nav-tabs clearfix"></ul></nav></div>');
        var e = $('<ul id="og-grid" class="og-grid"></ul>');
        for (itemIdx = 0; itemIdx < c; itemIdx++)
            if (void 0 != a.items[itemIdx]) {
                var f = a.items[itemIdx];
                liObject = $("<li></li>"), tags = f.tags, strTag = "";
                for (var g = tags.length - 1; g >= 0; g--) strTag += "," + tags[g];
                strTag = strTag.substring(1), liObject.attr("data-tags", strTag), aObject = $("<a></a>"), aObject.attr("href", "javascript:;;"), imgObject = $("<img/>");
                var h = f.thumbnail[0],
                    i = f.large[0],
                    j = parseVideoURL(i);
                // "youtube" != j.provider && "vimeo" != j.provider || (i = !1, imgObject.attr("data-video", j.embed)), imgObject.attr("src", h), imgObject.attr("data-largesrc", i), imgObject.attr("alt", f.img_title[0]), imgObject.attr("title", f.img_title[0]), spanObject = $("<span></span>"), spanObject.html(f.title), figureObject = $("<figure></figure>"), figureObject.append(spanObject), imgObject.appendTo(aObject), figureObject.appendTo(aObject), aObject.appendTo(liObject), liObject.appendTo(e)
            }
        "" == a.filterEffect && (a.filterEffect = "moveup"), e.addClass("effect-" + a.filterEffect), e.appendTo(b), 1 == a.hoverDirection && e.find("li").each(function() {
            $(this).hoverdir({
                hoverDelay: a.hoverDelay,
                inverse: a.hoverInverse
            })
        });
        var k = b.find("#portfolio-filter"),
            l = e.find("li"),
            m = {};
        numOfTag = 0, l.each(function(a) {
            var b = $(this),
                c = b.data("tags").split(",");
            b.attr("data-id", a), b.addClass("all"), $.each(c, function(a, c) {
                c = $.trim(c), b.addClass(c.toLowerCase().replace(" ", "-")), c in m || (m[c] = [], numOfTag++), m[c].push(b)
            })
        }), numOfTag > 1 ? (o(a.showAllText), $.each(m, function(a, b) {
            o(a)
        })) : k.remove(), k.find("a").bind("click", function(a) {
            p.find("li.og-expanded").find("a").trigger("click"), p.find(".og-close").trigger("click"), $this = $(this), $this.css("outline", "none"), k.find(".current").removeClass("current"), $this.parent().addClass("current");
            var b = $this.text().toLowerCase().replace(" ", "-"),
                d = c;
            return e.find("li").each(function(a, c) {
                classie.remove(c, "hidden"), classie.remove(c, "animate"), --d || setTimeout(function() {
                    n(e.find("li"), b)
                }, 1)
            }), !1
        }), k.find("li:first").addClass("current");
        var w, p = e,
            q = p.children("li"),
            r = -1,
            s = -1,
            t = 0,
            u = 10,
            v = $(window),
            x = $("html, body"),
            y = {
                WebkitTransition: "webkitTransitionEnd",
                MozTransition: "transitionend",
                OTransition: "oTransitionEnd",
                msTransition: "MSTransitionEnd",
                transition: "transitionend"
            },
            z = y[Modernizr.prefixed("transition")],
            A = Modernizr.csstransitions,
            B = {
                minHeight: a.expandingHeight,
                speed: a.expandingSpeed,
                easing: "ease"
            };
        J.prototype = {
            create: function() {
                this.$title = $("<h3></h3>"), this.$description = $("<p></p>"), this.$href = $('<a href="#">Visit website</a>'), this.$detailButtonList = $('<span class="buttons-list"></span>'), this.$details = $('<div class="og-details"></div>').append(this.$title, this.$description, this.$detailButtonList), this.$loading = $('<div class="og-loading"></div>'), this.$fullimage = $('<div class="og-fullimg"></div>').append(this.$loading), this.$closePreview = $('<span class="og-close"></span>'), this.$previewInner = $('<div class="og-expander-inner"></div>').append(this.$closePreview, this.$fullimage, this.$details), this.$previewEl = $('<div class="og-expander"></div>').append(this.$previewInner), this.$item.append($('<div class="og-pointer"></div>')), this.$item.append(this.getEl()), A && this.setTransition()
            },
            update: function(b) {
                if (b && (this.$item = b), -1 !== r) {
                    q.eq(r).removeClass("og-expanded"), this.$item.addClass("og-expanded"), this.positionPreview()
                }
                if (r = this.$item.index(), void 0 === a.items[r]);
                else {
                    if (eldata = a.items[r], this.$title.html(eldata.title), this.$description.html(eldata.description), this.$detailButtonList.html(""), urlList = eldata.button_list, urlList.length > 0)
                        for (g = 0; g < urlList.length; g++) {
                            var d = urlList[g].new_window ? "_blank" : "_self",
                                e = $('<a target="' + d + '"></a>');
                            e.addClass("link-button"), 0 == g && e.addClass("first"), e.attr("href", urlList[g].url), e.html(urlList[g].title), this.$detailButtonList.append(e)
                        }
                    var f = this;
                    if (void 0 !== f.$largeImg && f.$largeImg.remove(), glarge = eldata.large, gthumbs = eldata.thumbnail, imgTitle = eldata.img_title, glarge.length == gthumbs.length && glarge.length > 0) {
                        var h = $("<ul></ul>");
                        for (g = 0; g < gthumbs.length; g++) {
                            var i = gthumbs[g],
                                j = glarge[g],
                                k = $("<li></li>"),
                                e = $('<a href="javascript:;;"></a>'),
                                l = $("<img/>");
                            l.addClass("related_photo"), 0 == g && l.addClass("selected");
                            var m = parseVideoURL(j);
                            // "youtube" != m.provider && "vimeo" != m.provider || (j = !1, l.attr("data-video", m.embed)), l.attr("src", i), l.attr("data-large", j), l.attr("alt", imgTitle[g]), l.attr("title", imgTitle[g]), e.append(l), k.append(e), h.append(k)
                        }
                        h.addClass("elastislide-list"), h.elastislide();
                        var n = $('<div class="elastislide-wrapper elastislide-horizontal"></div>');
                        n.append(h).find(".related_photo").bind("click", function() {
                            n.find(".selected").removeClass("selected"), $(this).addClass("selected"), t = $(this).data("video"), u = $(this).data("large"), $titlePhoto = $(this).attr("title"), u && void 0 != typeof t ? $("<img/>").load(function() {
                                f.$fullimage.find("iframe").fadeOut(500, function() {
                                    f.$fullimage.find("img").fadeIn(500).attr("alt", $titlePhoto).attr("title", $titlePhoto).attr("src", u)
                                })
                            }).attr("alt", $titlePhoto).attr("title", $titlePhoto).attr("src", u) : f.$fullimage.find("img").fadeOut(500, function() {
                                f.$fullimage.find("iframe").fadeIn(500).attr("src", t)
                            })
                        }), f.$details.append('<div class="infosep"></div>'), f.$details.append(n)
                    } else f.$details.find(".infosep, .og-grid-small").remove();
                    if (f.$fullimage.is(":visible")) {
                        this.$loading.show();
                        var o = $('<iframe width="100%" height="100%" frameborder="0"></iframe>'),
                            p = $("<img/>");
                        f.$fullimage.append(o), f.$fullimage.append(p);
                        var s = f.$item.children("a").find("img"),
                            t = s.data("video"),
                            u = s.data("largesrc");
                        u && void 0 != typeof t ? p.load(function() {
                            var a = $(this);
                            a.attr("src") === u && (f.$loading.hide(), f.$fullimage.find("img").remove(), f.$largeImg = a.fadeIn(350), f.$fullimage.find("iframe").fadeOut(500, function() {
                                f.$fullimage.append(f.$largeImg)
                            }))
                        }).attr("src", eldata.large[0]) : (f.$loading.hide(), f.$fullimage.find("img").fadeOut(500, function() {
                            f.$fullimage.find("iframe").fadeIn(500).attr("src", t)
                        }))
                    }
                }
            },
            open: function() {
                setTimeout($.proxy(function() {
                    this.setHeights(), this.positionPreview()
                }, this), 25)
            },
            close: function() {
                var a = this,
                    b = function() {
                        A && $(this).off(z), a.$item.removeClass("og-expanded"), a.$previewEl.remove()
                    };
                return setTimeout($.proxy(function() {
                    void 0 !== this.$largeImg && this.$largeImg.fadeOut("fast"), this.$previewEl.css("height", 0);
                    var a = q.eq(this.expandedIdx);
                    a.css("height", a.data("height")).on(z, b), A || b.call()
                }, this), 25), !1
            },
            calcHeight: function() {
                var a = w.height - this.$item.data("height") - u,
                    b = w.height;
                a < B.minHeight && (a = B.minHeight, b = B.minHeight + this.$item.data("height") + u), this.height = a, this.itemHeight = b
            },
            setHeights: function() {
                var a = this,
                    b = function() {
                        A && a.$item.off(z), a.$item.addClass("og-expanded")
                    };
                this.calcHeight(), this.$previewEl.css("height", this.height), this.$item.css("height", this.itemHeight).on(z, b), A || b.call()
            },
            positionPreview: function() {
                var a = this.$item.data("offsetTop"),
                    b = this.$previewEl.offset().top - t,
                    c = this.height + this.$item.data("height") + u <= w.height ? a : this.height < w.height ? b - (w.height - this.height) : b;
                x.animate({
                    scrollTop: c
                }, B.speed)
            },
            setTransition: function() {
                this.$previewEl.css("transition", "height " + B.speed + "ms " + B.easing), this.$item.css("transition", "height " + B.speed + "ms " + B.easing)
            },
            getEl: function() {
                return this.$previewEl
            }
        }, p.imagesLoaded(function() {
            D(!0), G(), E()
        })
    }
});
